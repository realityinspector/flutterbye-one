<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Settings - FLUTTERBYE: The CRM Focused on Healthy Meetings</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <style>
    /* Define primary gradient */
    :root {
      --primary-gradient: linear-gradient(135deg, #0066ff 0%, #1a88ff 100%);
      --primary: #0066ff;
      --primary-dark: #0052cc;
      --secondary: #e6f0ff;
      --dark: #333;
      --light: #f7f7f7;
      --success: #28a745;
      --danger: #dc3545;
      --warning: #ffc107;
      --info: #17a2b8;
      --sidebar-width: 250px;
      --success-light: rgba(40, 167, 69, 0.1);
      --danger-light: rgba(220, 53, 69, 0.1);
      --warning-light: rgba(255, 193, 7, 0.1);
      --info-light: rgba(23, 162, 184, 0.1);
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      line-height: 1.6;
      color: var(--dark);
      background-color: var(--light);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    a {
      text-decoration: none;
      color: var(--primary);
    }
    
    ul {
      list-style: none;
    }
    
    .dashboard {
      display: flex;
      min-height: 100vh;
    }
    
    /* Sidebar Styles */
    .sidebar {
      width: var(--sidebar-width);
      background-color: var(--primary-dark);
      color: white;
      padding: 2rem 1rem;
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
    }
    
    .sidebar .branding {
      display: flex;
      align-items: center;
      margin-bottom: 2rem;
      padding: 0 0.5rem;
    }
    
    .logo {
      font-size: 1.5rem;
      font-weight: 700;
      color: white;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .logo i {
      margin-right: 8px;
    }
    
    .menu-items {
      margin-top: 1rem;
    }
    
    .menu-item {
      display: flex;
      align-items: center;
      padding: 0.75rem 1rem;
      margin-bottom: 0.5rem;
      border-radius: 4px;
      transition: background-color 0.3s ease;
      cursor: pointer;
    }
    
    .menu-item:hover, .menu-item.active {
      background-color: var(--primary);
    }
    
    .menu-item i {
      margin-right: 10px;
      width: 20px;
      text-align: center;
    }
    
    .menu-item a {
      color: white;
      flex-grow: 1;
    }
    
    .menu-divider {
      height: 1px;
      background-color: rgba(255, 255, 255, 0.1);
      margin: 1rem 0;
    }
    
    /* Main Content */
    .main-content {
      flex-grow: 1;
      margin-left: var(--sidebar-width);
      padding: 2rem;
    }
    
    /* Top Bar */
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }
    
    .page-title {
      font-size: 1.5rem;
      font-weight: 600;
    }
    
    /* User dropdown */
    .user-dropdown {
      position: relative;
    }
    
    .user-dropdown-toggle {
      display: flex;
      align-items: center;
      cursor: pointer;
    }
    
    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      margin-right: 10px;
    }
    
    .user-info {
      display: flex;
      flex-direction: column;
    }
    
    .user-name {
      font-weight: 600;
    }
    
    .user-role {
      font-size: 0.8rem;
      color: #666;
    }
    
    .user-dropdown-menu {
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 10px;
      background-color: white;
      border-radius: 4px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      min-width: 200px;
      display: none;
      z-index: 10;
    }
    
    .user-dropdown-menu.show {
      display: block;
    }
    
    .dropdown-item {
      padding: 0.75rem 1rem;
      display: flex;
      align-items: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .dropdown-item:hover {
      background-color: var(--secondary);
    }
    
    .dropdown-item i {
      margin-right: 10px;
      width: 20px;
      text-align: center;
    }
    
    .dropdown-divider {
      height: 1px;
      background-color: #eee;
    }

    /* Settings Specific Styles */
    .settings-grid {
      display: grid;
      grid-template-columns: 250px 1fr;
      gap: 1.5rem;
    }
    
    .settings-nav {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      padding: 1.5rem;
    }
    
    .settings-nav ul {
      list-style: none;
      padding: 0;
    }
    
    .settings-nav li {
      margin-bottom: 0.75rem;
    }
    
    .settings-nav a {
      display: flex;
      align-items: center;
      padding: 0.75rem 1rem;
      border-radius: 4px;
      color: var(--dark);
      transition: all 0.3s ease;
    }
    
    .settings-nav a:hover, .settings-nav a.active {
      background-color: var(--secondary);
      color: var(--primary);
    }
    
    .settings-nav i {
      margin-right: 10px;
      color: #666;
      width: 20px;
      text-align: center;
    }
    
    .settings-content {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      padding: 2rem;
    }
    
    .settings-section {
      margin-bottom: 2.5rem;
    }
    
    .settings-section:last-child {
      margin-bottom: 0;
    }
    
    .settings-section h2 {
      font-size: 1.3rem;
      margin-bottom: 1.5rem;
      color: var(--dark);
      padding-bottom: 0.75rem;
      border-bottom: 1px solid #eee;
    }
    
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }
    
    .form-control {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }
    
    .form-control:focus {
      border-color: var(--primary);
      outline: none;
    }
    
    .btn {
      padding: 0.75rem 1.5rem;
      border-radius: 4px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
    }
    
    .btn-primary {
      background-color: var(--primary);
      color: white;
    }
    
    .btn-primary:hover {
      background-color: var(--primary-dark);
    }
    
    .btn-outline {
      background-color: transparent;
      border: 1px solid var(--primary);
      color: var(--primary);
    }
    
    .btn-outline:hover {
      background-color: var(--primary);
      color: white;
    }
    
    /* Team Management Section */
    .team-members {
      margin-top: 1.5rem;
    }
    
    .team-member {
      display: flex;
      align-items: center;
      padding: 1rem;
      border: 1px solid #eee;
      border-radius: 4px;
      margin-bottom: 1rem;
    }
    
    .team-member-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: var(--secondary);
      color: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      margin-right: 1rem;
    }
    
    .team-member-info {
      flex-grow: 1;
    }
    
    .team-member-name {
      font-weight: 600;
    }
    
    .team-member-email {
      font-size: 0.9rem;
      color: #666;
    }
    
    .team-member-actions {
      display: flex;
      gap: 0.5rem;
    }
    
    .member-role-badge {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      margin-left: 0.5rem;
      background-color: var(--info-light);
      color: var(--info);
    }
    
    .member-role-badge.admin {
      background-color: var(--success-light);
      color: var(--success);
    }
    
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.5);
      align-items: center;
      justify-content: center;
    }
    
    .modal-content {
      background-color: white;
      margin: auto;
      padding: 0;
      border-radius: 8px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      width: 90%;
      max-width: 500px;
      position: relative;
      animation: modalFadeIn 0.3s ease-out;
    }
    
    @keyframes modalFadeIn {
      from {transform: translateY(-50px); opacity: 0;}
      to {transform: translateY(0); opacity: 1;}
    }
    
    .modal-header {
      padding: 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #eee;
    }
    
    .modal-header h2 {
      margin: 0;
      font-size: 1.3rem;
    }
    
    .close-modal {
      font-size: 1.5rem;
      font-weight: 700;
      cursor: pointer;
      color: #999;
    }
    
    .close-modal:hover {
      color: var(--dark);
    }
    
    .modal-body {
      padding: 1.5rem;
    }
    
    .modal-actions {
      padding: 1.5rem;
      border-top: 1px solid #eee;
      text-align: right;
    }
    
    .modal-actions button {
      margin-left: 0.5rem;
    }
    
    /* Invite form */
    .invite-form {
      margin-top: 1.5rem;
    }
    
    /* Mobile responsiveness */
    @media (max-width: 768px) {
      .sidebar {
        width: 60px;
        overflow: hidden;
      }
      
      .sidebar .logo {
        display: none;
      }
      
      .sidebar .menu-item span {
        display: none;
      }
      
      .sidebar .menu-item {
        justify-content: center;
      }
      
      .sidebar .menu-item i {
        margin-right: 0;
      }
      
      .main-content {
        margin-left: 60px;
        padding: 1rem;
      }
      
      .settings-grid {
        grid-template-columns: 1fr;
      }
      
      .team-member {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .team-member-avatar {
        margin-bottom: 0.75rem;
      }
      
      .team-member-actions {
        margin-top: 0.75rem;
      }
    }
  </style>
</head>
<body>

  <div class="dashboard">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="branding">
        <div class="logo">
          <i class="fas fa-wind"></i>
          FLUTTERBYE
        </div>
      </div>
      
      <div class="menu-items">
        <div class="menu-item">
          <i class="fas fa-tachometer-alt"></i>
          <a href="/dashboard">Dashboard</a>
        </div>
        <div class="menu-item">
          <i class="fas fa-users"></i>
          <a href="/leads">Leads</a>
        </div>
        <div class="menu-item">
          <i class="fas fa-phone-alt"></i>
          <a href="/calls">Calls</a>
        </div>
        <div class="menu-divider"></div>
        <div class="menu-item">
          <i class="fas fa-chart-bar"></i>
          <a href="#">Analytics</a>
        </div>
        <div class="menu-divider"></div>
        <div class="menu-item active">
          <i class="fas fa-cog"></i>
          <a href="/settings">Settings</a>
        </div>
        <div class="menu-item">
          <i class="fas fa-question-circle"></i>
          <a href="#">Help</a>
        </div>
      </div>
    </aside>
    
    <!-- Main Content -->
    <main class="main-content">
      <!-- Top Bar -->
      <div class="top-bar">
        <h1 class="page-title">Settings</h1>
        <div class="user-dropdown">
          <div class="user-dropdown-toggle" id="userDropdownToggle">
            <div class="user-avatar" id="userAvatar">DU</div>
            <div class="user-info">
              <div class="user-name" id="userName">Demo User</div>
              <div class="user-role">Sales Rep</div>
            </div>
          </div>
          <div class="user-dropdown-menu" id="userDropdownMenu">
            <div class="dropdown-item">
              <i class="fas fa-user"></i>
              <span>Profile</span>
            </div>
            <div class="dropdown-item" id="settingsBtn">
              <i class="fas fa-cog"></i>
              <span>Settings</span>
            </div>
            <div class="dropdown-divider"></div>
            <div class="dropdown-item" id="logoutBtn">
              <i class="fas fa-sign-out-alt"></i>
              <span>Logout</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Settings Content -->
      <div class="settings-grid">
        <!-- Settings Navigation -->
        <div class="settings-nav">
          <ul>
            <li><a href="#profile" class="active" data-section="profile"><i class="fas fa-user"></i> Profile</a></li>
            <li><a href="#team" data-section="team"><i class="fas fa-users"></i> Team Management</a></li>
            <li><a href="#notifications" data-section="notifications"><i class="fas fa-bell"></i> Notifications</a></li>
            <li><a href="#security" data-section="security"><i class="fas fa-shield-alt"></i> Security</a></li>
            <li><a href="#integrations" data-section="integrations"><i class="fas fa-plug"></i> Integrations</a></li>
          </ul>
        </div>
        
        <!-- Settings Content -->
        <div class="settings-content">
          <!-- Profile Settings Section -->
          <div class="settings-section" id="profile-section">
            <h2>Profile Settings</h2>
            <form id="profileForm">
              <div class="form-group">
                <label for="fullName">Full Name</label>
                <input type="text" id="fullName" class="form-control" placeholder="Your name">
              </div>
              <div class="form-group">
                <label for="email">Email Address</label>
                <input type="email" id="email" class="form-control" placeholder="Your email">
              </div>
              <div class="form-group">
                <label for="companyName">Company Name</label>
                <input type="text" id="companyName" class="form-control" placeholder="Your company name">
              </div>
              <div class="form-group">
                <label for="phoneNumber">Phone Number</label>
                <input type="tel" id="phoneNumber" class="form-control" placeholder="Your phone number">
              </div>
              <button type="submit" class="btn btn-primary">Save Changes</button>
            </form>
          </div>
          
          <!-- Team Management Section -->
          <div class="settings-section" id="team-section" style="display: none;">
            <h2>Team Management</h2>
            <p>Manage team members and control their access to your organization.</p>
            
            <div class="btn-group" style="margin-bottom: 1.5rem;">
              <button class="btn btn-primary" id="inviteTeamMemberBtn">
                <i class="fas fa-plus"></i> Invite Team Member
              </button>
            </div>
            
            <div class="team-members" id="teamMembersList">
              <!-- Team members will be populated here -->
              <div class="loading-status">Loading team members...</div>
            </div>
          </div>
          
          <!-- Notifications Section -->
          <div class="settings-section" id="notifications-section" style="display: none;">
            <h2>Notification Settings</h2>
            <p>Control how and when you receive notifications.</p>
            
            <div class="form-group">
              <label for="emailNotifications">Email Notifications</label>
              <div class="checkbox-list">
                <div class="checkbox-item">
                  <input type="checkbox" id="notifyNewLeads" checked>
                  <label for="notifyNewLeads">New lead assignments</label>
                </div>
                <div class="checkbox-item">
                  <input type="checkbox" id="notifyCallReminders" checked>
                  <label for="notifyCallReminders">Call reminders</label>
                </div>
                <div class="checkbox-item">
                  <input type="checkbox" id="notifyTeamUpdates" checked>
                  <label for="notifyTeamUpdates">Team updates</label>
                </div>
                <div class="checkbox-item">
                  <input type="checkbox" id="notifySystemUpdates">
                  <label for="notifySystemUpdates">System updates & newsletters</label>
                </div>
              </div>
            </div>
            
            <button class="btn btn-primary">Save Notification Settings</button>
          </div>
          
          <!-- Security Section -->
          <div class="settings-section" id="security-section" style="display: none;">
            <h2>Security Settings</h2>
            
            <div class="form-group">
              <label for="currentPassword">Current Password</label>
              <input type="password" id="currentPassword" class="form-control">
            </div>
            <div class="form-group">
              <label for="newPassword">New Password</label>
              <input type="password" id="newPassword" class="form-control">
            </div>
            <div class="form-group">
              <label for="confirmPassword">Confirm New Password</label>
              <input type="password" id="confirmPassword" class="form-control">
            </div>
            
            <button class="btn btn-primary">Change Password</button>
            
            <div class="form-group" style="margin-top: 2rem;">
              <label>Two-Factor Authentication</label>
              <div style="display: flex; align-items: center; margin-top: 0.5rem;">
                <div style="margin-right: 1rem;">
                  <span class="status-badge" style="background-color: var(--danger-light); color: var(--danger); padding: 0.25rem 0.5rem; border-radius: 20px; font-size: 0.8rem;">Disabled</span>
                </div>
                <button class="btn btn-outline">Enable 2FA</button>
              </div>
            </div>
          </div>
          
          <!-- Integrations Section -->
          <div class="settings-section" id="integrations-section" style="display: none;">
            <h2>Integrations</h2>
            <p>Connect FLUTTERBYE with other services you use.</p>
            
            <div class="integration-list">
              <div class="integration-item">
                <div class="integration-logo">
                  <i class="fab fa-google" style="font-size: 2rem; color: #4285F4;"></i>
                </div>
                <div class="integration-info">
                  <h3>Google Calendar</h3>
                  <p>Sync your meetings and calls with Google Calendar</p>
                </div>
                <div class="integration-action">
                  <button class="btn btn-outline">Connect</button>
                </div>
              </div>
              
              <div class="integration-item" style="margin-top: 1.5rem;">
                <div class="integration-logo">
                  <i class="fab fa-slack" style="font-size: 2rem; color: #4A154B;"></i>
                </div>
                <div class="integration-info">
                  <h3>Slack</h3>
                  <p>Get notifications and updates in your Slack workspace</p>
                </div>
                <div class="integration-action">
                  <button class="btn btn-outline">Connect</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
  
  <!-- Invite Team Member Modal -->
  <div id="inviteModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2><i class="fas fa-user-plus"></i> Invite Team Member</h2>
        <span class="close-modal">&times;</span>
      </div>
      <div class="modal-body">
        <form id="inviteForm">
          <div class="form-group">
            <label for="inviteEmail">Email Address*</label>
            <input type="email" id="inviteEmail" class="form-control" placeholder="colleague@example.com" required>
          </div>
          <div class="form-group">
            <label for="inviteRole">Role*</label>
            <select id="inviteRole" class="form-control" required>
              <option value="">-- Select Role --</option>
              <option value="member">Member</option>
              <option value="admin">Admin</option>
            </select>
          </div>
          <div class="form-group">
            <label for="inviteMessage">Personal Message (Optional)</label>
            <textarea id="inviteMessage" class="form-control" rows="3" placeholder="Add a personal message to the invitation email"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-actions">
        <button class="btn btn-outline" id="cancelInviteBtn">Cancel</button>
        <button class="btn btn-primary" id="sendInviteBtn">Send Invitation</button>
      </div>
    </div>
  </div>
  
  <!-- Edit Team Member Modal -->
  <div id="editMemberModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2><i class="fas fa-user-edit"></i> Edit Team Member</h2>
        <span class="close-modal">&times;</span>
      </div>
      <div class="modal-body">
        <form id="editMemberForm">
          <input type="hidden" id="editMemberId">
          <div class="form-group">
            <label for="editMemberName">Name</label>
            <input type="text" id="editMemberName" class="form-control" readonly>
          </div>
          <div class="form-group">
            <label for="editMemberEmail">Email</label>
            <input type="email" id="editMemberEmail" class="form-control" readonly>
          </div>
          <div class="form-group">
            <label for="editMemberRole">Role*</label>
            <select id="editMemberRole" class="form-control" required>
              <option value="member">Member</option>
              <option value="admin">Admin</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-actions">
        <button class="btn btn-outline" id="cancelEditBtn">Cancel</button>
        <button class="btn btn-primary" id="saveEditBtn">Save Changes</button>
      </div>
    </div>
  </div>
  
  <!-- Remove Team Member Modal -->
  <div id="removeMemberModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2><i class="fas fa-user-minus"></i> Remove Team Member</h2>
        <span class="close-modal">&times;</span>
      </div>
      <div class="modal-body">
        <input type="hidden" id="removeMemberId">
        <p>Are you sure you want to remove <span id="removeMemberName">this team member</span> from your organization?</p>
        <p>This action cannot be undone, and the user will lose access to all shared data.</p>
      </div>
      <div class="modal-actions">
        <button class="btn btn-outline" id="cancelRemoveBtn">Cancel</button>
        <button class="btn btn-danger" id="confirmRemoveBtn">Remove Member</button>
      </div>
    </div>
  </div>
  
  <!-- Create Organization Modal -->
  <div id="createOrgModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2><i class="fas fa-building"></i> Create Organization</h2>
        <span class="close-modal">&times;</span>
      </div>
      <div class="modal-body">
        <form id="createOrgForm">
          <div class="form-group">
            <label for="orgName">Organization Name*</label>
            <input type="text" id="orgName" class="form-control" placeholder="Your Company Name" required>
          </div>
          <div class="form-group">
            <label for="orgDescription">Description</label>
            <textarea id="orgDescription" class="form-control" rows="3" placeholder="Brief description of your organization"></textarea>
          </div>
          <div class="form-group">
            <label for="orgIndustry">Industry</label>
            <select id="orgIndustry" class="form-control">
              <option value="">-- Select Industry --</option>
              <option value="Technology">Technology</option>
              <option value="Healthcare">Healthcare</option>
              <option value="Finance">Finance</option>
              <option value="Education">Education</option>
              <option value="Manufacturing">Manufacturing</option>
              <option value="Retail">Retail</option>
              <option value="Consulting">Consulting</option>
              <option value="Other">Other</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-actions">
        <button class="btn btn-outline" id="cancelCreateOrgBtn">Cancel</button>
        <button class="btn btn-primary" id="saveCreateOrgBtn">Create Organization</button>
      </div>
    </div>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const currentUser = {
        id: null,
        username: '',
        fullName: '',
        email: '',
        companyName: '',
        role: '',
        organizations: []
      };
      
      let teamMembers = [];
      let currentOrganization = null;
      
      // Toggle user dropdown
      const userDropdownToggle = document.getElementById('userDropdownToggle');
      const userDropdownMenu = document.getElementById('userDropdownMenu');
      
      userDropdownToggle.addEventListener('click', function() {
        userDropdownMenu.classList.toggle('show');
      });
      
      // Close dropdown when clicking outside
      window.addEventListener('click', function(event) {
        if (!userDropdownToggle.contains(event.target) && !userDropdownMenu.contains(event.target)) {
          userDropdownMenu.classList.remove('show');
        }
      });
      
      // Handle settings navigation
      const settingsNavLinks = document.querySelectorAll('.settings-nav a');
      const settingsSections = document.querySelectorAll('.settings-section');
      
      settingsNavLinks.forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          const sectionId = this.getAttribute('data-section');
          
          // Update active link
          settingsNavLinks.forEach(l => l.classList.remove('active'));
          this.classList.add('active');
          
          // Show selected section, hide others
          settingsSections.forEach(section => {
            if (section.id === `${sectionId}-section`) {
              section.style.display = 'block';
            } else {
              section.style.display = 'none';
            }
          });
        });
      });
      
      // Modal functionality
      const modals = document.querySelectorAll('.modal');
      const closeButtons = document.querySelectorAll('.close-modal');
      
      function openModal(modalId) {
        const modal = document.getElementById(modalId);
        modal.style.display = 'flex';
      }
      
      function closeModal(modalId) {
        const modal = document.getElementById(modalId);
        modal.style.display = 'none';
      }
      
      function closeAllModals() {
        modals.forEach(modal => {
          modal.style.display = 'none';
        });
      }
      
      // Close button functionality
      closeButtons.forEach(button => {
        button.addEventListener('click', function() {
          const modal = this.closest('.modal');
          modal.style.display = 'none';
        });
      });
      
      // Close modals when clicking outside
      window.addEventListener('click', function(event) {
        modals.forEach(modal => {
          if (event.target === modal) {
            modal.style.display = 'none';
          }
        });
      });
      
      // Invite team member
      const inviteTeamMemberBtn = document.getElementById('inviteTeamMemberBtn');
      const cancelInviteBtn = document.getElementById('cancelInviteBtn');
      const sendInviteBtn = document.getElementById('sendInviteBtn');
      const inviteForm = document.getElementById('inviteForm');
      
      inviteTeamMemberBtn.addEventListener('click', function() {
        openModal('inviteModal');
      });
      
      cancelInviteBtn.addEventListener('click', function() {
        closeModal('inviteModal');
        inviteForm.reset();
      });
      
      sendInviteBtn.addEventListener('click', function() {
        const email = document.getElementById('inviteEmail').value;
        const role = document.getElementById('inviteRole').value;
        const message = document.getElementById('inviteMessage').value;
        
        if (!email || !role) {
          alert('Please fill in all required fields.');
          return;
        }
        
        // Send invitation
        sendInvitation(email, role, message);
      });
      
      // Cancel edit team member
      document.getElementById('cancelEditBtn').addEventListener('click', function() {
        closeModal('editMemberModal');
      });
      
      // Save edit team member
      document.getElementById('saveEditBtn').addEventListener('click', function() {
        const memberId = document.getElementById('editMemberId').value;
        const role = document.getElementById('editMemberRole').value;
        
        updateTeamMember(memberId, role);
      });
      
      // Cancel remove team member
      document.getElementById('cancelRemoveBtn').addEventListener('click', function() {
        closeModal('removeMemberModal');
      });
      
      // Confirm remove team member
      document.getElementById('confirmRemoveBtn').addEventListener('click', function() {
        const memberId = document.getElementById('removeMemberId').value;
        
        removeTeamMember(memberId);
      });
      
      // Create organization modal events
      document.getElementById('cancelCreateOrgBtn').addEventListener('click', function() {
        closeModal('createOrgModal');
        document.getElementById('createOrgForm').reset();
      });
      
      document.getElementById('saveCreateOrgBtn').addEventListener('click', function() {
        createOrganization();
      });
      
      // Profile form submission
      const profileForm = document.getElementById('profileForm');
      
      profileForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = {
          fullName: document.getElementById('fullName').value,
          email: document.getElementById('email').value,
          companyName: document.getElementById('companyName').value,
          phoneNumber: document.getElementById('phoneNumber').value
        };
        
        // Update user profile
        updateUserProfile(formData);
      });
      
      // Fetch current user
      function fetchCurrentUser() {
        fetch('/api/user', {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json'
          },
          credentials: 'include'
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to fetch user data');
          }
          return response.json();
        })
        .then(data => {
          if (data.success && data.user) {
            // Update current user data
            Object.assign(currentUser, data.user);
            
            // Update UI with user data
            updateUserUI();
            
            // Fetch organizations
            fetchUserOrganizations();
          } else {
            console.error('Invalid user data response');
          }
        })
        .catch(error => {
          console.error('Error fetching user data:', error);
        });
      }
      
      // Fetch user organizations
      function fetchUserOrganizations() {
        fetch('/api/organizations', {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json'
          },
          credentials: 'include'
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to fetch organizations');
          }
          return response.json();
        })
        .then(data => {
          if (data.success && data.data) {
            currentUser.organizations = data.data;
            
            // Set current organization
            if (currentUser.organizations.length > 0) {
              currentOrganization = currentUser.organizations[0];
              
              // Fetch team members for the current organization
              fetchTeamMembers(currentOrganization.id);
            } else {
              // Create a new organization if none exists
              const teamMembersList = document.getElementById('teamMembersList');
              teamMembersList.innerHTML = `
                <div class="no-data-message">
                  <p>You don't have any organizations yet. Create one to start adding team members.</p>
                  <button id="createOrgBtn" class="btn btn-primary" style="margin-top: 1rem;">
                    <i class="fas fa-plus"></i> Create Organization
                  </button>
                </div>
              `;
              
              const createOrgBtn = document.getElementById('createOrgBtn');
              if (createOrgBtn) {
                createOrgBtn.addEventListener('click', function() {
                  // Show create organization modal
                  openModal('createOrgModal');
                });
              }
            }
          } else {
            console.error('Invalid organizations response');
          }
        })
        .catch(error => {
          console.error('Error fetching organizations:', error);
        });
      }
      
      // Intentionally left empty - createDefaultOrganization has been replaced by the createOrganization function
      
      // Create a new organization
      function createOrganization() {
        const orgName = document.getElementById('orgName').value;
        const orgDescription = document.getElementById('orgDescription').value;
        const orgIndustry = document.getElementById('orgIndustry').value;
        
        if (!orgName) {
          alert('Please enter an organization name.');
          return;
        }
        
        const orgData = {
          name: orgName,
          description: orgDescription,
          industry: orgIndustry
        };
        
        fetch('/api/organizations', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          credentials: 'include',
          body: JSON.stringify(orgData)
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to create organization');
          }
          return response.json();
        })
        .then(data => {
          if (data.success && data.data) {
            // Add new organization to list
            if (!currentUser.organizations) {
              currentUser.organizations = [];
            }
            
            currentUser.organizations.push(data.data);
            
            // Set as current organization
            currentOrganization = data.data;
            
            // Close the modal
            closeModal('createOrgModal');
            
            // Clear form
            document.getElementById('createOrgForm').reset();
            
            // Refresh team management section
            const teamMembersList = document.getElementById('teamMembersList');
            teamMembersList.innerHTML = '<div class="loading-status">Loading team members...</div>';
            
            // Update team members list
            fetchTeamMembers(currentOrganization.id);
            
            // Show success message
            alert('Organization created successfully!');
          } else {
            console.error('Invalid create organization response');
            alert('Failed to create organization. Please try again.');
          }
        })
        .catch(error => {
          console.error('Error creating organization:', error);
          alert('Failed to create organization. Please try again.');
        });
      }
      
      // Fetch team members
      function fetchTeamMembers(organizationId) {
        if (!organizationId) {
          const teamMembersList = document.getElementById('teamMembersList');
          teamMembersList.innerHTML = `
            <div class="no-data-message">
              <p>You don't have any organizations yet. Create one to start adding team members.</p>
              <button id="createOrgBtn" class="btn btn-primary" style="margin-top: 1rem;">
                <i class="fas fa-plus"></i> Create Organization
              </button>
            </div>
          `;
          
          const createOrgBtn = document.getElementById('createOrgBtn');
          if (createOrgBtn) {
            createOrgBtn.addEventListener('click', function() {
              openModal('createOrgModal');
            });
          }
          return;
        }
        
        const teamMembersList = document.getElementById('teamMembersList');
        teamMembersList.innerHTML = '<div class="loading-status">Loading team members...</div>';
        
        fetch(`/api/organizations/${organizationId}/members`, {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json'
          },
          credentials: 'include'
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to fetch team members');
          }
          return response.json();
        })
        .then(data => {
          if (data.success && data.data) {
            teamMembers = data.data;
            renderTeamMembers();
          } else {
            console.error('Invalid team members response');
            teamMembersList.innerHTML = '<div class="error-message">Failed to load team members.</div>';
          }
        })
        .catch(error => {
          console.error('Error fetching team members:', error);
          teamMembersList.innerHTML = '<div class="error-message">Failed to load team members.</div>';
        });
      }
      
      // Render team members
      function renderTeamMembers() {
        const teamMembersList = document.getElementById('teamMembersList');
        
        if (teamMembers.length === 0) {
          teamMembersList.innerHTML = `
            <div class="no-data-message">
              <p>No team members found. Invite someone to get started.</p>
            </div>
          `;
          return;
        }
        
        let html = '';
        
        teamMembers.forEach(member => {
          const isCurrentUser = member.user.id === currentUser.id;
          const initials = getInitials(member.user.fullName || member.user.username);
          
          html += `
            <div class="team-member" data-member-id="${member.id}">
              <div class="team-member-avatar">${initials}</div>
              <div class="team-member-info">
                <div class="team-member-name">
                  ${member.user.fullName || member.user.username}
                  ${isCurrentUser ? ' (You)' : ''}
                  <span class="member-role-badge ${member.role === 'admin' ? 'admin' : ''}">${member.role}</span>
                </div>
                <div class="team-member-email">${member.user.email}</div>
              </div>
              ${!isCurrentUser ? `
                <div class="team-member-actions">
                  <button class="btn btn-outline btn-sm edit-member-btn" data-member-id="${member.id}">
                    <i class="fas fa-edit"></i> Edit
                  </button>
                  <button class="btn btn-outline btn-sm remove-member-btn" data-member-id="${member.id}">
                    <i class="fas fa-user-minus"></i> Remove
                  </button>
                </div>
              ` : ''}
            </div>
          `;
        });
        
        teamMembersList.innerHTML = html;
        
        // Add event listeners to action buttons
        document.querySelectorAll('.edit-member-btn').forEach(button => {
          button.addEventListener('click', function() {
            const memberId = this.getAttribute('data-member-id');
            const member = teamMembers.find(m => m.id.toString() === memberId);
            
            if (member) {
              showEditMemberModal(member);
            }
          });
        });
        
        document.querySelectorAll('.remove-member-btn').forEach(button => {
          button.addEventListener('click', function() {
            const memberId = this.getAttribute('data-member-id');
            const member = teamMembers.find(m => m.id.toString() === memberId);
            
            if (member) {
              showRemoveMemberModal(member);
            }
          });
        });
      }
      
      // Show edit member modal
      function showEditMemberModal(member) {
        document.getElementById('editMemberId').value = member.id;
        document.getElementById('editMemberName').value = member.user.fullName || member.user.username;
        document.getElementById('editMemberEmail').value = member.user.email;
        document.getElementById('editMemberRole').value = member.role;
        
        openModal('editMemberModal');
      }
      
      // Show remove member modal
      function showRemoveMemberModal(member) {
        document.getElementById('removeMemberId').value = member.id;
        document.getElementById('removeMemberName').textContent = member.user.fullName || member.user.username;
        
        openModal('removeMemberModal');
      }
      
      // Send invitation
      function sendInvitation(email, role, message) {
        if (!currentOrganization) {
          alert('No organization selected.');
          return;
        }
        
        const inviteData = {
          email,
          role,
          message
        };
        
        fetch(`/api/organizations/${currentOrganization.id}/members`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          credentials: 'include',
          body: JSON.stringify(inviteData)
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to send invitation');
          }
          return response.json();
        })
        .then(data => {
          if (data.success) {
            alert('Invitation sent successfully!');
            closeModal('inviteModal');
            inviteForm.reset();
            
            // Refresh team members
            fetchTeamMembers(currentOrganization.id);
          } else {
            alert(data.message || 'Failed to send invitation.');
          }
        })
        .catch(error => {
          console.error('Error sending invitation:', error);
          alert('Failed to send invitation. Please try again.');
        });
      }
      
      // Update team member
      function updateTeamMember(memberId, role) {
        if (!currentOrganization) {
          alert('No organization selected.');
          return;
        }
        
        const updateData = {
          role
        };
        
        fetch(`/api/organizations/${currentOrganization.id}/members/${memberId}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          credentials: 'include',
          body: JSON.stringify(updateData)
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to update team member');
          }
          return response.json();
        })
        .then(data => {
          if (data.success) {
            alert('Team member updated successfully!');
            closeModal('editMemberModal');
            
            // Refresh team members
            fetchTeamMembers(currentOrganization.id);
          } else {
            alert(data.message || 'Failed to update team member.');
          }
        })
        .catch(error => {
          console.error('Error updating team member:', error);
          alert('Failed to update team member. Please try again.');
        });
      }
      
      // Remove team member
      function removeTeamMember(memberId) {
        if (!currentOrganization) {
          alert('No organization selected.');
          return;
        }
        
        fetch(`/api/organizations/${currentOrganization.id}/members/${memberId}`, {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json'
          },
          credentials: 'include'
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to remove team member');
          }
          return response.json();
        })
        .then(data => {
          if (data.success) {
            alert('Team member removed successfully!');
            closeModal('removeMemberModal');
            
            // Refresh team members
            fetchTeamMembers(currentOrganization.id);
          } else {
            alert(data.message || 'Failed to remove team member.');
          }
        })
        .catch(error => {
          console.error('Error removing team member:', error);
          alert('Failed to remove team member. Please try again.');
        });
      }
      
      // Update user profile
      function updateUserProfile(formData) {
        fetch('/api/user', {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          credentials: 'include',
          body: JSON.stringify(formData)
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to update profile');
          }
          return response.json();
        })
        .then(data => {
          if (data.success) {
            alert('Profile updated successfully!');
            
            // Update current user data
            Object.assign(currentUser, data.user);
            
            // Update UI
            updateUserUI();
          } else {
            alert(data.message || 'Failed to update profile.');
          }
        })
        .catch(error => {
          console.error('Error updating profile:', error);
          alert('Failed to update profile. Please try again.');
        });
      }
      
      // Update user UI
      function updateUserUI() {
        // Update user dropdown
        document.getElementById('userAvatar').textContent = getInitials(currentUser.fullName || currentUser.username);
        document.getElementById('userName').textContent = currentUser.fullName || currentUser.username;
        
        // Fill profile form
        document.getElementById('fullName').value = currentUser.fullName || '';
        document.getElementById('email').value = currentUser.email || '';
        document.getElementById('companyName').value = currentUser.companyName || '';
        document.getElementById('phoneNumber').value = currentUser.phoneNumber || '';
      }
      
      // Helper function to get initials from name
      function getInitials(name) {
        if (!name) return '?';
        
        const names = name.split(' ');
        if (names.length === 1) {
          return names[0].charAt(0).toUpperCase();
        } else {
          return (names[0].charAt(0) + names[names.length - 1].charAt(0)).toUpperCase();
        }
      }
      
      // Settings button functionality
      const settingsBtn = document.getElementById('settingsBtn');
      
      settingsBtn.addEventListener('click', function() {
        // Navigate to settings page
        window.location.href = '/settings';
      });
      
      // Logout functionality
      const logoutBtn = document.getElementById('logoutBtn');
      
      logoutBtn.addEventListener('click', function() {
        fetch('/api/logout', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          credentials: 'include'
        })
        .then(() => {
          // Redirect to landing page after logout
          window.location.href = '/';
        })
        .catch(error => {
          console.error('Logout error:', error);
        });
      });
      
      // Initialize
      fetchCurrentUser();
    });
  </script>
</body>
</html>